<div data-controller="posts">
  <%= link_to new_post_path, class: 'add-new-button' do %>
    <%= image_tag 'add-new.png' %>
  <% end %>
  <% @posts.each do |post| %>
    <div class="post-card">
      <% if post.photo.attached? %>
        <div class="post-card-image">
          <%= cl_image_tag post.photo.key, width: 500, quality: :auto %>
        </div>
      <% end %>
      <div class="post-card-content">
        <div class="post-user" data-target="posts.postCard">
          <%= render 'post_user', post: post %>
        </div>
        <p class="boldest m-0"><%= post.user.username ? post.user.username : post.user.full_name %> <span style="font-weight: 200;"><%= post.caption %></span></p>
        <% if post.comments.count > 5 %>
          <p class="text-12 bold m-0 grey">view all <%= post.comments.count %> comments</span></p>
        <% else %>
          <% post.comments.each do |comment| %>
            <p class="boldest m-0"><%= comment.user.username ? comment.user.username : comment.user.full_name %> <span style="font-weight: 200;"><%= comment.content %></span></p>
          <% end %>
        <% end %>
      </div>
      <% unless post.user == current_user %>
        <%= simple_form_for [post, @comment] do |f| %>
          <%= f.input :content,
                      required: true,
                      label: false,
                      placeholder: 'Add a comment...',
                      input_html: { class: 'post-card-form-input' } %>
          <%= f.submit 'Post', class: 'post-card-form-button' %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
